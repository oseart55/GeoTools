(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const ne=4,b=document.getElementById("tableContainer"),D=document.createElement("div"),z=document.getElementById("myTable");let j=!0;D.className="tab";D.textContent="\u25B2";b.appendChild(D);let H,A=!0;function Z(t){const e=H-t.y;H=t.y,b.style.height=parseInt(getComputedStyle(b).height)+e+"px"}b.addEventListener("mousedown",function(t){t.offsetY<ne&&(H=t.y,document.addEventListener("mousemove",Z,!1))},!1);document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",Z,!1)},!1);D.addEventListener("click",function(){A=!A,A?(_(j),b.classList.add("collapsed"),D.textContent="\u25B2"):(_(!j),b.classList.remove("collapsed"),D.textContent="\u25BC")});function k(t,e){let n=[];const r=t==="circle"?e.getLatLng():null,o=t==="circle"?e.getRadius():null,a=t==="rectangle"?e.getBounds():null,l=t==="polygon"?e.getLatLngs()[0]:null;M.eachLayer(i=>{if(!(i instanceof L.Marker))return;const c=i.getLatLng();switch(t){case"circle":c.distanceTo(r)<=o&&n.push(i);break;case"rectangle":a.contains(c)&&n.push(i);break;case"polygon":e.getBounds().contains(c)&&ae(c,l)&&n.push(i);break}}),W(n)}function W(t){b.classList.remove("collapsed"),A=!1,_(!j);let e=z.querySelector("tbody");e||(e=z.appendChild(document.createElement("tbody")));const n=new Set;e.querySelectorAll("tr td:first-child").forEach(o=>{n.add(o.textContent)});const r=document.createDocumentFragment();t.forEach(o=>{const a=o.data;if(n.has(a.Asset_ID))return;const l=document.createElement("tr");l.innerHTML=`
            <td id="asset_id">${a.Asset_ID}</td>
            <td id="asset_name">${a.Asset_Name}</td>
            <td id="asset_location">${a.Location}</td>
            <td id="asset_details">${a.Details}</td>
        `,l.addEventListener("dblclick",function(i){console.log(i.target.parentNode)}),r.appendChild(l)}),e.appendChild(r)}function _(t){var e=document.querySelector(".leaflet-control-attribution");e&&(t?e.classList.remove("hidden-attribution"):e.classList.add("hidden-attribution"))}function ae(t,e){let n=t.lat,r=t.lng,o=!1;for(let a=0,l=e.length-1;a<e.length;l=a++){let i=e[a].lat,c=e[a].lng,p=e[l].lat,g=e[l].lng;c>r!=g>r&&n<(p-i)*(r-c)/(g-c)+i&&(o=!o)}return o}function re(){s.addEventListener(L.Draw.Event.CREATED,function(t){t.layerType;var e=t.layer;e.bindContextMenu({contextmenu:!0,contextmenuItems:[{text:"Remove Polygon",index:1,callback:function(){h.removeLayer(e)}},{separator:!0,index:2}]}),h.addLayer(e)}),s.on("draw:drawstart",function(t){s.off("click",G),s.on("click",G)})}function le(){h.addEventListener("layeradd",function(t){t.layer instanceof L.Rectangle&&k("rectangle",t.layer),t.layer instanceof L.Circle&&k("circle",t.layer),t.layer instanceof L.Polygon&&k("polygon",t.layer)}),h.addEventListener("layerremove",function(t){const n=document.getElementById("myTable").querySelector("tbody");n.innerHTML="",h.eachLayer(function(r){t.layer instanceof L.Rectangle?k("rectangle",r):k("circle",r)})})}function G(t){let e=t.latlng,n=h.getLayers();if(n.length>0){let r=n[0],o=r.getLatLngs()[0];if(o.length>2){let a=o[0];s.distance(a,e)<10&&(r.addLatLng(a),s.off("click",G))}}}L.drawLocal.draw.toolbar.buttons.rectangle="Search By Polygon";L.drawLocal.draw.toolbar.buttons.circle="Search By Circle";var h=new L.FeatureGroup;let q=new L.Control.Draw({draw:{marker:!1,polyline:!1,rectangle:{metric:!1},circle:{metric:!1},circlemarker:!1},edit:{featureGroup:h,edit:!0,remove:!1}});le();L.Control.SearchButton=L.Control.extend({options:{position:"topleft"},onAdd:function(t){var e=L.DomUtil.create("div","leaflet-bar leaflet-control leaflet-search"),n=L.DomUtil.create("a","leaflet-control-button",e);return L.DomUtil.addClass(n,"fa fa-search"),L.DomEvent.disableClickPropagation(n),this._isSearching=!1,L.DomEvent.on(n,"click",()=>{this._isSearching?(t.removeControl(q),this._isSearching=!1):(t.addControl(q),this._isSearching=!0)}),e.title="Geometry Search",e}});var se=new L.Control.SearchButton;L.Control.HelpButton=L.Control.extend({options:{position:"topright"},onAdd:function(t){var e=L.DomUtil.create("div","leaflet-bar leaflet-control leaflet-help"),n=L.DomUtil.create("a","leaflet-control-button",e);return L.DomUtil.addClass(n,"fa fa-info-circle"),L.DomEvent.disableClickPropagation(n),n.addEventListener("click",function(r){modal.style.display="flex",document.body.style.overflow="hidden",document.getElementById("openModal");const o=document.getElementById("closeModal"),a=document.getElementById("exitModal");function l(){modal.style.display="none",document.body.style.overflow="auto"}window.addEventListener("keydown",i=>{i.key==="Escape"&&modal.style.display!="none"&&l()}),o.addEventListener("click",l),a.addEventListener("click",l)}),e.title="Help",e}});var T=new L.Control.HelpButton;L.Control.SettingsButton=L.Control.extend({options:{position:"topright"},onAdd:function(t){var e=L.DomUtil.create("div","leaflet-bar leaflet-control leaflet-settings"),n=L.DomUtil.create("a","leaflet-control-button",e),r=document.getElementById("settings"),o=document.getElementById("tableContainerSizer");const a=document.getElementById("tableContainer");let l=a.parentElement;return L.DomUtil.addClass(n,"fa fa-gear"),L.DomEvent.disableClickPropagation(n),n.addEventListener("click",function(i){a.classList.remove("collapsed");let c,p;a.addEventListener("transitionend",function(){c=l.clientHeight,p=a.clientHeight/c*100,o.value=Math.round(p)},{once:!0}),o.value=Math.round(p),o.addEventListener("change",function(){let v=parseFloat(o.value);if(!isNaN(v)){let u=v/100*c;a.style.height=`${u}px`}}),r.style.display="flex",document.body.style.overflow="hidden";const g=r.querySelector("#closeModal"),y=r.querySelector("#exitModal");function S(){r.style.display="none",document.body.style.overflow="auto",a.classList.add("collapsed")}window.addEventListener("keydown",v=>{if(v.key==="ArrowUp"&&document.activeElement.tagName==="INPUT"){o.value=parseInt(o.value)+1;let u=parseFloat(o.value);if(!isNaN(u)){let C=u/100*c;a.style.height=`${C}px`}}if(v.key==="ArrowDown"&&document.activeElement.tagName==="INPUT"){o.value=parseInt(o.value)-1;let u=parseFloat(o.value);if(!isNaN(u)){let C=u/100*c;a.style.height=`${C}px`}}v.key==="Escape"&&r.style.display!="none"&&S()}),g.addEventListener("click",S),y.addEventListener("click",S)}),e.title="Settings",e}});var B=new L.Control.SettingsButton;L.Control.CustomSearch=L.Control.extend({onAdd:function(t){let e=L.DomUtil.create("div","leaflet-bar leaflet-control leaflet-control-custom"),n=L.DomUtil.create("a","leaflet-draw-draw-custom fa fa-font",e);n.href="#";let r=L.DomUtil.create("div","leaflet-custom-search-panel",e);r.style.display="none";let o=L.DomUtil.create("label","",r);o.innerText="Text Search:";let a=L.DomUtil.create("input","leaflet-draw-search-input",r);a.type="text",a.placeholder="Enter text...";let l=L.DomUtil.create("label","",r);l.innerText="Asset Name:";let i=L.DomUtil.create("select","leaflet-draw-search-select",r),c=L.DomUtil.create("option","",i);c.value="Select Asset",c.innerText="Select Asset";var p=N.getLayers();p.forEach(d=>{d.eachLayer(m=>{const f=m.data;let O=L.DomUtil.create("option","",i);O.value=f.Asset_Name,O.innerText=f.Asset_Name})});let g=L.DomUtil.create("label","",r);g.innerText="State Name:";let y=L.DomUtil.create("select","leaflet-draw-search-select",r),S=L.DomUtil.create("option","",y);S.value="Select State",S.innerText="Select State",P.getLayers().forEach(d=>{d.eachLayer(m=>{let f=L.DomUtil.create("option","",y);f.value=m.feature.properties.name,f.innerText=m.feature.properties.name})});let u=L.DomUtil.create("button","leaflet-custom-search-button",r);u.innerText="Search";let C=L.DomUtil.create("button","leaflet-custom-search-reset-button",r);return C.innerText="Reset",L.DomEvent.on(n,"click",function(d){L.DomEvent.stopPropagation(d),L.DomEvent.preventDefault(d),r.style.display==="none"?(r.style.display="block",a.focus()):r.style.display="none"}),[r,a,i,u].forEach(d=>{L.DomEvent.on(d,"mousedown",L.DomEvent.stopPropagation).on(d,"touchstart",L.DomEvent.stopPropagation)}),L.DomEvent.on(u,"click",function(){let d=a.value,m=i.value,f=y.value;if(d==""&&m=="Select Asset"&&f=="Select State")return;var O=N.getLayers(),I=[],te=P.getLayers();te.forEach(U=>{U.getLayers().forEach(w=>{if(w.feature.properties.name.toLowerCase()===f.toLowerCase()){let E=w.feature.geometry;E.type==="Polygon"?I.push(E.coordinates[0]):E.type==="MultiPolygon"&&E.coordinates.forEach(oe=>I.push(oe[0]))}})});let F=[];O.forEach(U=>{U.eachLayer(x=>{if(!x.data)return;const w=x.data;let E=x.getLatLng();if(d!==""&&!w.Asset_ID.toLowerCase().includes(d.toLowerCase())&&!w.Asset_Name.toLowerCase().includes(d.toLowerCase())&&!w.Details.toLowerCase().includes(d.toLowerCase())||m!=="Select Asset"&&!w.Asset_Name.toLowerCase().includes(m.toLowerCase())||f!=="Select State"&&!ce(E,I)&&!V(E,I)){t.removeLayer(x);return}F.push(x)})}),document.querySelector("tbody").innerHTML="",W(F)}),L.DomEvent.on(C,"click",function(){var d=N.getLayers();d.forEach(m=>{m.eachLayer(f=>{t.addLayer(f)})}),a.value="",i.value="Select Asset",y.value="Select State",document.querySelector("tbody").innerHTML=""}),e.title="Custom Search",e},onRemove:function(t){}});let ie=new L.Control.CustomSearch({position:"topleft"});function V(t,e){let[n,r]=[t.lng,t.lat],o=!1;for(let a=0,l=e.length-1;a<e.length;l=a++){let[i,c]=e[a],[p,g]=e[l];c>r!=g>r&&n<(p-i)*(r-c)/(g-c)+i&&(o=!o)}return o}function ce(t,e){for(let n=0;n<e.length;n++)if(V(t,e[n]))return!0;return!1}function de(t){const e=JSON.parse(t);return window.geojsonLayer&&window.map.removeLayer(window.geojsonLayer),window.geojsonLayer=L.geoJSON(e,{onEachFeature:ue}),window.geojsonLayer}function ue(t,e){if(t.properties){let n="";for(let r in t.properties){let o=t.properties[r];typeof o=="object"&&(o=JSON.stringify(o)),n+=`<b>${r}:</b> ${o}<br>`}e.bindPopup(n)}}document.addEventListener("dragover",t=>{t.preventDefault(),t.dataTransfer.dropEffect="copy"});document.addEventListener("drop",t=>{t.preventDefault();const e=t.dataTransfer.files[0];if(e&&e.type==="application/json"){const n=new FileReader;n.onload=function(r){const o=r.target.result;window.runtime.EventsEmit("geojson-file-dropped",{fileName:e.name,data:o})},n.readAsText(e)}});const K=new Worker(new URL("/assets/markerWorker.df657faf.js",self.location),{type:"module"});K.onmessage=function(t){t.data.forEach(({lat:n,lng:r,data:o})=>{let a=L.marker([n,r]);a.data=o,M.addLayer(a)}),fetch("https://raw.githubusercontent.com/oseart55/GeoTools/refs/heads/main/Files/us-states.json").then(n=>n.json()).then(n=>{L.geoJSON(n).addTo(P),ie.addTo(s)}).catch(n=>console.error("Error loading GeoJSON:",n))};let J;var M=new L.FeatureGroup,P=new L.FeatureGroup,fe=new L.LatLng(37.396346,-110.895996),Y=L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd",maxZoom:20}),N=L.layerGroup([M,h]),Q={"CartoDB Dark":Y},R={"US States":P,Markers:M},s=L.map("map",{center:fe,zoom:5,layers:[Y,N],contextmenu:!0,contextmenuWidth:140,contextmenuItems:[{text:"Show coordinates",callback:pe},{text:"Center map here",callback:ge},"-",{text:"Zoom in",icon:"https://raw.githubusercontent.com/oseart55/GeoTools/main/Images/zoom-in.png",callback:Le},{text:"Zoom out",icon:"https://raw.githubusercontent.com/oseart55/GeoTools/main/Images/zoom-out.png",callback:ye}]}),$=L.control.layers(Q,R).addTo(s);re();K.postMessage(1e3);se.addTo(s);T.addTo(s);B.addTo(s);window.runtime.EventsOn("geojsonLoaded",t=>{let e=de(t);e.addTo(N),s.fitBounds(e.getBounds())});window.runtime.EventsOn("toggleHelpButton",t=>{t==!0?s.addControl(T):s.removeControl(T),ee("displayHelp",t),window.runtime.EventsEmit("toggleHelpButton")});window.runtime.EventsOn("toggleSettingsButton",t=>{t==!0?s.addControl(B):s.removeControl(B),ee("displaySettings",t),window.runtime.EventsEmit("toggleSettingsButton")});window.runtime.EventsOn("Reload",()=>{location.reload()});window.runtime.EventsOn("settingsLoaded",t=>{try{const e=JSON.parse(atob(t.replaceAll('"',"")));J=e,e.user.displayHelp==!0?s.addControl(T):s.removeControl(T),e.user.displaySettings==!0?s.addControl(B):s.removeControl(B)}catch(e){console.error("Failed to parse settings JSON:",e)}});window.runtime.EventsOn("geojson-fileDrop",t=>{try{const e=JSON.parse(t);X(e)}catch(e){console.error("Invalid GeoJSON:",e)}});window.runtime.EventsOn("geojson-loaded",t=>{const e=JSON.parse(t.data);try{X(e,t.fileName)}catch(n){console.error("Invalid GeoJSON:",n)}});function X(t,e){R[e]=L.geoJSON(t).addTo(s),$.remove(),$=L.control.layers(Q,R).addTo(s)}async function me(t){try{const e=JSON.stringify(t);await window.runtime.EventsEmit("saveSettings",e),console.log("Settings change notified to backend.")}catch(e){console.error("Error notifying backend:",e)}}function ee(t,e){J.user[t]=e,me(J),L.DomEvent.stopPropagation()}function pe(t){alert(t.latlng)}function ge(t){s.panTo(t.latlng)}function Le(t){s.zoomIn()}function ye(t){s.zoomOut()}
